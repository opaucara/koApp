function getURLParam(e){"use strict";var t="",n=window.location.href,r=false,i=e+"=",s=i.length,o,u,a,f;if(n.indexOf("?")>-1){o=n.substr(n.indexOf("?")+1);u=o.split("&");for(a=0;a<u.length;a++){if(u[a].substr(0,s)===i){f=u[a].split("=");t=f[1];r=true;break}}}if(r===false){return null}return t}function delete_cookie(e){document.cookie=e+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT;"}function createCookie(e,t){var n='[{"goalkeeper":"0","defender":"0","midfielder":"0","attacker":"0","manager":"0"}, {"miPlayers":""}, {"goalkeeper":1, "defender":4, "midfielder":3, "attacker":3, "manager":1}, {"token":"'+e+'"}, {"league":""}, {"season":""}, {"userName":"'+t+'"}]';return n}function getCookie(e){var t=document.cookie,n=t.indexOf(" "+e+"="),r;if(n===-1){n=t.indexOf(e+"=")}if(n===-1){t=null}else{n=t.indexOf("=",n)+1;r=t.indexOf(";",n);if(r===-1){r=t.length}t=unescape(t.substring(n,r))}return t}function setCookie(e,t,n){var r=new Date,i="";if(n!==null){r.setDate(r.getDate()+n)}i=escape(t)+"; expires="+r.toUTCString();document.cookie=e+"="+i}function verifyCookieExist(){var e=$.parseJSON(getCookie("players"));if(getCookie("players")===null||e[3].token===""){location.href="/index.html"}}function addSetHeader(e,t){var n="",r=".play";switch(e){case"/":n="";break;case"/index.php":n="";break;case"/ligas.html":n=i18n.getTranslation("txt_choose_league");r=".play";break;case"/ranking.html":n=i18n.getTranslation("txt_ranking");r=".ranking";break;case"/mis-equipos.html":n=i18n.getTranslation("txt_my_teams");r=".teams";break;case"/ver-equipo.html":n=i18n.getTranslation("txt_show_team");r=".play";break;case"/reglamento.html":n=i18n.getTranslation("txt_rules");r=".rules";break;case"/exito.html":n=i18n.getTranslation("txt_congratulations");r="";if(document.location.hash==="#suscribe"){console.log("suscription");$(".suscribe").show()}else{$(".team-created").show()}break;case"/premios.html":n=i18n.getTranslation("txt_prizes");r=".no";break;case"/editar-equipo.html":n=i18n.getTranslation("txt_edit_team");r=".no";break;case"/home.html":n="";r=".play";break;case"/perfil.html":n="";r=".no";$(".container-general").css("display","none");$(document.location.hash).show().addClass("active");if(document.location.hash!=="#login"&&document.location.hash!=="#send-pwd-sms"){verifyCookieExist()}if(document.location.hash==="#subscription-on"||document.location.hash==="#subscription-off"){n=i18n.getTranslation("txt_profile");$("body.subscription-page").addClass("subscription-inactive")}else{$("body.subscription-page").addClass("subscription-perfil")}break;case"/suscripcion.html":n=i18n.getTranslation("txt_suscription");r="";break;default:n=i18n.getTranslation("txt_create_team");r=".play";break}t=t.replace(i18n.getTranslation("txt_create_team"),n);$(".header").empty().html(t);$(".menu li"+r).addClass("active")}function initialSetTeamCookie(e,t){var n=$.parseJSON(getCookie("players")),r=n[6].userName,i='[{"goalkeeper":"0","defender":"0","midfielder":"0","attacker":"0","manager":"0"}, {"miPlayers":""}, {"goalkeeper":1, "defender":4, "midfielder":3, "attacker":3, "manager":1}, {"token":"'+e+'"}, {"league":""}, {"season":""}, {"userName":"'+r+'"}]';setCookie(t,i,1e3)}function includeHeader(){if($(".header").length){$.ajax({url:"/header.html",timeout:1e4,dataType:"script",success:function(e,t,n){e=i18n.translateTemplate(e);addSetHeader(document.location.pathname,e);window.scrollTo(0,0);var r=$.parseJSON(getCookie("players")),i=r[3]["token"]||"";if(document.location.pathname==="/ligas.html"&&i===""||document.location.pathname==="/terms.html"&&i===""||document.location.pathname==="/crear-equipo.html"&&i===""){$("a.show-menu").hide()}}})}}function countPosition(e,t){return e.reduce(function(e,n,r,i){return n.position===t?e+1:e},0)}function shortNamePosition(e){var t="";switch(e){case"goalkeeper":t=i18n.getTranslation("txt_goalkeeper");break;case"defender":t=i18n.getTranslation("txt_defender");break;case"midfielder":t=i18n.getTranslation("txt_midfielder");break;case"attacker":t=i18n.getTranslation("txt_attacker");break;case"manager":t=i18n.getTranslation("txt_manager");break}return t}function createPlayerRow(e,t,n){var r="",i="";if(e.id_entry===e.id_home){r=e.home}else{r=e.away}i+='<li class="player-'+t+" "+e.position+'">';i+='<a data-idp="'+e.id_player+'" data-club="'+r+'"data-idClub="'+e.id_entry+'"  data-name="'+e.full_name+'" data-pos="'+e.position+'" href="#" class="ic-choose '+t+'"><span class="rol">'+n+"</span>";i+='<span class="player-name">'+e.full_name+'<span class="club">'+r+"</span></span>";i+='<span class="ic-arrow">&nbsp;</span></a></li>';return i}function createPlayerRowSee(e,t,n){var r,i,s="";if(e.id_home===e.id_entry){r=e.home;i=e.id_home}else{r=e.away;i=e.id_away}s+='<li class="player-'+t+" "+e.position+'">';s+='<a data-idp="'+e.id_player+'" data-club="'+r+'"data-idClub="'+i+'"  data-name="'+e.full_name+'" data-pos="'+e.position+'" href="#" class="ic-choose plus"><span class="rol">'+n+"</span>";s+='<span class="player-name">'+e.full_name+'<span class="club">'+r+"</span></span>";s+='<span class="ic-arrow">'+e.points+"</span></a>";s+='<p class="player-details"></p></li>';return s}function createListTeamToEdit(e,t,n){var r=[],i="",s=countPosition(e,"goalkeeper"),o=countPosition(e,"defender"),u=countPosition(e,"midfielder"),a=countPosition(e,"attacker"),f=countPosition(e,"manager"),l="",c,h="",p="",d="";r.goalkeeper=r.defender=r.midfielder=r.attacker=r.manager="";$.each(e,function(e,t){h=p=d="";if(t.id_home===t.id_entry){h=t.home;p=t.id_home}else{h=t.away;p=t.id_away}i+=t.position+":"+t.id_player+":"+t.full_name+":"+h+":"+p+",";d=shortNamePosition(t.position);if(n==="see-team"){r[t.position]+=createPlayerRowSee(t,"plus",d)}else{r[t.position]+=createPlayerRow(t,"minus",d)}});c='[{"goalkeeper":"'+s+'","defender":"'+o+'","midfielder":"'+u+'","attacker":"'+a+'","manager":"'+f+'"}, {"miPlayers":"'+i+'"}, {"goalkeeper":"'+s+'","defender":"'+o+'","midfielder":"'+u+'","attacker":"'+a+'","manager":"'+f+'"}, {"token":"'+t[3].token+'"}, {"league":"'+t[4].league+'"}, {"season":"'+t[5].season+'"}, {"userName": "'+t[6].userName+'"}]';if(n==="see-team"){$(".players-list-edit").remove();l+='<ul class="players-list-edit players-list">'+r.goalkeeper+r.defender+r.midfielder+r.attacker+r.manager+"</ul>"}else{l+='<ul class="mi-team players-list">'+r.goalkeeper+r.defender+r.midfielder+r.attacker+r.manager+"</ul>";$(".mi-team").remove()}$(l).insertAfter(".formations");c[3].token=t[3].token;c[4].league="";c[5].season="";setCookie("players",c,1e3)}function createListTeamToEditLyF(){$(".loading").hide();$("body.create-team ul.mi-team").toggleClass("mi-team-edit")}function createListFormationLyF(e){$("ul.formations li.selected").removeClass("selected");if(Number(e.attacker)===2){if(Number(e.defender)===5){$("ul.formations li").eq(3).addClass("selected")}else{$("ul.formations li").eq(1).addClass("selected")}}else if(Number(e.attacker)===3&&Number(e.defender)===3){$("ul.formations li").eq(2).addClass("selected")}else{$("ul.formations li").eq(0).addClass("selected")}}function showError(e){var t,n;if(e!==""){if(e instanceof Object){n=t.errors.message}else{try{t=$.parseJSON(e);if(t==="null"){n=i18n.getTranslation("msg_service_error")}else{n=t.errors.message}}catch(r){n=e}}}else{n=i18n.getTranslation("msg_service_error");}$("p.msj-error").text(n);$("p.msj-error").show();setTimeout(function(){$(".msj-error").hide()},3e3)}function showSuccess(e){$("p.msj-success").text(e);$("p.msj-success").show();setTimeout(function(){$(".msj-success").hide()},3e3)}function timeleft(e){var t;if(e-1440<=0){if(e-60>0){t=Utils.sprintf(i18n.getTranslation("txt_remaining_hours"),Math.floor(e/60))}else{t=Utils.sprintf(i18n.getTranslation("txt_remaining_minutes"),e)}}else if(e<2880){t=Utils.sprintf(i18n.getTranslation("txt_remaining_day"),Math.floor(e/1440))}else{t=Utils.sprintf(i18n.getTranslation("txt_remaining_days"),(e>10080?" + ":"")+Math.floor(e/1440))}return t}function urlTreatment(){if(document.location.hash!==""){var e=$.parseJSON(getCookie("players")),t=document.location.hash.split("="),n,r,i;switch(t[0]){case"#details":break;case"#edit":$(".loading").show();if(e[4].league!==""||e[5].season!==""){n=e[3].token;initialSetTeamCookie("","seleccion");initialSetTeamCookie(n,"players");r=t[1];$.ajax({url:API_URL+"/api/me/seats/"+r+"/players",timeout:9e4,data:{token:n},dataType:"json",success:function(t,n,r){createListTeamToEdit(t,e,"");createListTeamToEditLyF();i=$.parseJSON(getCookie("players"));createListFormationLyF(i[2])},error:function(e,t,n){showError(e.response)},complete:function(){$(".loading").hide()}})}else{location.href="/mis-equipos.html"}break}}}function showLeagues(){if(!SINGLE_TOURNAMENT){$("div.container-details").hide();$("div.container-liga").show()}}function createLeague(e,t){var n="",r,i;$.each(e,function(e,s){r=timeleft(s.start_on);if(t!==""){i=s.active_league==false?"disable":"";n+='<li class="league-'+s.id_tournament+" league "+i+'"><a data-time-on="'+r+'" data-idSeason="'+s.id_season+'" href="#details"><span class="icon">&nbsp;</span><span class="container"><span class="name">'+s.description+'</span><span class="remaining">'+r+"</span></span></a></li>"}else{n+='<li data-idLeague="'+s.id_league+'" class="league-'+s.id_tournament+' league" data-idSeason="'+s.id_season+'"><span class="icon">&nbsp;</span><span class="container"><span class="name">'+s.tournament+'</span><span class="remaining"></span></span></li>'}});return n}function loadLeagues(){$(".loading").show();var e=null;$.ajax({url:API_URL+"/api/tournaments",dataType:"json",success:function(t){if(!SINGLE_TOURNAMENT){var n=createLeague(t,1);$("ul#teams").empty();$("ul#teams").append(n)}else{if(t.length){e=t.shift();showDetailsLeague(e.id_season,timeleft(e.start_on))}}},error:function(e,t,n){showError(e.response)},complete:function(){$(".loading").hide()}})}function showDetailsLeague(e,t){$("body.league p.msj-error").hide();var n="",r=API_URL+"/api/leagues/";$.ajax({type:"GET",data:{season:e},url:r,dataType:"json",success:function(e){$("p.current-date").text(Utils.sprintf(i18n.getTranslation("txt_games_this_week"),e.tournament));$.each(e.events,function(e,t){n+="<li>"+t.home+" vs "+t.away+"</li>"});$(".container-details ul.list").empty();var t=new Array(e),r="",i=createLeague(t,r);$(".container-details ul.list").append(i);$("ul.matches").empty();$("ul.matches").append(n);$("div.container-liga").hide();$("div.container-details").show()},error:function(e,t,n){$(".loading").css("display","none");showError(e.response)},complete:function(){$(".loading").hide();ga("send","pageview","/ligas/detalle/"+e+".html");$("div.container-details ul.list li .container span.remaining").html(t)}})}function getPlayerPoints(e,t,n){var r=$.parseJSON(getCookie("players")),i="",s=r[3].token,o=e.attr("data-idp");ga("send","pageview","/ver-equipo/"+t+"/jugador/"+o);$.ajax({type:"GET",url:API_URL+"/api/me/seats/"+t+"/players/"+o+"/incidents",data:{token:s},dataType:"json",success:function(t){$.each(t,function(e,t){i+="<span>"+t.description+": "+t.points+"</span>"});e.parent("li").children("p.player-details").append(i);e.addClass("fulled")},error:function(t,n,r){if(t.status===404){e.parent("li").children("p.player-details").append("<span>"+i18n.getTranslation("txt_player_no_points")+"</span>");e.addClass("fulled")}else{showError(t.response)}},complete:function(){$(".loading").hide()}})}function playersClubCount(e,t){var n=e.split(",").clean(""),r="",i;$.each(n,function(e,s){i=n[e].split(":");if(i[4]===t){r++}});return r}function changeListByIdClubAdd(e){$.each($("ul.to-select li.player-plus a"),function(t,n){if($(n).attr("data-idClub")===e&&!$(n).parent("li").hasClass("player-minus")){$(n).parent("li.player-plus").removeClass("player-plus").addClass("player-cancel")}})}function changeListByIdClubRemove(e){$.each($("ul.to-select li.player-cancel a"),function(t,n){if($(n).attr("data-idClub")===e){$(n).parent("li.player-cancel").removeClass("player-cancel").addClass("player-plus");$(n).removeClass("cancel").addClass("plus")}})}function countOccurrenceIdClub(e,t){var n=0,r=e.split(","),i;$.each(r,function(e,s){i=r[e].split(":");if(i===t.attr("data-idClub")){n++}});return n}function addPlayer(e){var t=e.attr("data-idp"),n=e.attr("data-pos"),r=e.attr("data-name"),i=e.attr("data-club"),s=e.attr("data-idClub"),o=$.parseJSON(getCookie("seleccion")),u=o[1].miPlayers,a=0,f,l,c;a=playersClubCount(u,s);if(o[0][n]<o[2][n]&&a<maxPlayerAllowGeneral){f=++o[0][n];l=parseInt(o[2][n],10);o[1].miPlayers+=n+":"+t+":"+r+":"+i+":"+s+",";o=JSON.stringify(o);setCookie("seleccion",o,1e3);e.removeClass("plus");e.addClass("minus");e.parent("li").addClass("player-minus").removeClass("player-plus");$(".count-selected").text(f);if(f===l){window.scrollTo(0,0);$(".player-plus").hide();$(".btn-filters").hide();$(".player-cancel").hide()}}if(a>=maxPlayerAllowGeneral-1){changeListByIdClubAdd(s);a=0}}function removePlayer(e,t){var n=$.parseJSON(getCookie(t)),r=n[1].miPlayers,i=e.attr("data-pos")+":"+e.attr("data-idp")+":"+e.attr("data-name")+":"+e.attr("data-club")+":"+e.attr("data-idClub")+",",s,o,u,a,f;r=r.replace(i,"");$.each(n[0],function(i,a){if(i===e.attr("data-pos")){a--;n[0][i]=a;n[1].miPlayers=r;s=n[0][i];o=n[2][i];n=JSON.stringify(n);setCookie(t,n,1e3);e.parent("li").removeClass("player-minus").addClass("player-plus");u=parseInt($(".count-selected").text(),10)-1;$(".count-selected").text(u);if(s<o){$(".player-plus").show();$(".btn-filters").show();$(".player-cancel").show()}}});a=e.attr("data-idClub");f=countOccurrenceIdClub(r,e);if(f===0){changeListByIdClubRemove(a)}}function formatPlayer(e,t){var n=[],r;n.position=e[0];n.id_player=e[1];n.full_name=e[2];n.home=e[3];n.id_entry=e[4];n.id_home=e[4];r=shortNamePosition(n.position);if(t!=="minus"){t="plus"}return createPlayerRow(n,t,r)}function createListSelectPlayerJson(e,t,n,r){var i="",s,o,u=[],a=[],f,l,c,h;if(r===""){setCookie("seleccion",getCookie("players"),1e3)}s=$.parseJSON(getCookie("seleccion"));o=s[1].miPlayers.split(",").clean("");$.each(o,function(e,t){f=t.split(":");if(f[0]===n){u.push(f[1])}a[f[4]]=++a[f[4]]||1});$.each(e,function(t,r){if(e[t].position===n){l=e[t].id_player;c="";h=shortNamePosition(e[t].position);if(u.indexOf(l)!==-1){c="minus"}else{if(a[e[t].id_entry]===maxPlayerAllowGeneral){c="cancel"}else{c="plus"}}i+=createPlayerRow(e[t],c,h)}});$("#players").html("<ul class='players-list to-select'>"+i+'</ul><a class="btn-back-team" href="javascript:void(0);">'+i18n.getTranslation("btn_save_selection")+"</a>")}function createListSelectPlayer(e){var t=e[1].miPlayers.split(","),n=e[2],r=[],i=[],s,o,u,a,f,l,c="";r.goalkeeper=0;r.defender=0;r.midfielder=0;r.attacker=0;r.manager=0;i.goalkeeper="";i.defender="";i.midfielder="";i.attacker="";i.manager="";$.each(t,function(a,f){s=t[a].split(":");o="minus";if(s[0]!==""){if(r[s[0]]<n[s[0]]&&s[0]!=="goalkeeper"&&s[0]!=="manager"){i[s[0]]+=formatPlayer(s,o);r[s[0]]++}else if(s[0]==="goalkeeper"||s[0]==="manager"){i[s[0]]+=formatPlayer(s,o);r[s[0]]=1}else{u=t[a]+",";e[0][s[0]]=e[0][s[0]]-1;e[1].miPlayers=e[1].miPlayers.replace(u,"")}}});$.each(n,function(e,t){a=shortNamePosition(e);f=n[e]-r[e];if(f>0){for(l=1;l<=f;l++){text=e=="manager"?i18n.getTranslation("txt_select_mgr"):i18n.getTranslation("txt_select_player");i[e]+='<li class="player-plus '+e+'"><a data-pos="'+e+'" href="#" class="ic-choose plus"><span class="rol">'+a+'</span><span class="player-name">'+text+'</span><span class="ic-arrow">&nbsp;</span></a></li>'}}});c='<ul class="mi-team players-list">'+i.goalkeeper+i.defender+i.midfielder+i.attacker+i.manager+"</ul>";e=JSON.stringify(e);setCookie("players",e,1e3);$(".mi-team").remove();$(c).insertAfter(".formations")}function createFilters(e){var t="";$.each(e,function(e,n){t+='<li class="plus"><a href="#" data-event="'+n.id_event+'"><span class="filter-match"><span>'+n.home+"</span> vs <span>"+n.away+'</span> </span><span class="ic-arrow"></span></a></li>'});if(t!==""){$(".filter-list").empty();$(".filter-list").append(t)}}function callMatches(e){var t=API_URL+"/api/leagues/";$(".loading").show();$.ajax({type:"GET",url:t,data:{season:e},dataType:"json",success:function(t){window.scrollTo(0,0);if(e!==""){createFilters(t.events);location.hash="filter";$("#players").toggle();$("#filters").toggle();$("span.text-title").empty().text(i18n.getTranslation("txt_filter_by_game"));$(".count-rol").toggle();$("body").toggleClass("show-msj filter-msj")}},error:function(e,t,n){showError(e.response)},complete:function(){$(".loading").hide();ga("send","pageview","/equipo/filtrar-partidos.html")}})}function callPlayersFiltersLyF(){$("#players").toggle();$("#filters").toggle();$(".count-rol").toggle();$("body").toggleClass("show-msj filter-msj");$("span.text-title").empty().text(i18n.getTranslation("txt_select_players"))}function callPlayersLyF(e,t){location.hash="seleccion";$(".page-title span.text-title").text(i18n.getTranslation("txt_select_players"));var n="--";switch(e){case"goalkeeper":n=i18n.getTranslation("txt_goalkeeper_lbl");break;case"defender":n=i18n.getTranslation("txt_defender_lbl");break;case"midfielder":n=i18n.getTranslation("txt_midfielder_lbl");break;case"attacker":n=i18n.getTranslation("txt_attacker_lbl");break;case"manager":n=i18n.getTranslation("txt_manager_lbl");break}$("p.count-rol .rol").text(n).attr("position",e);$(".btn-done, .btn-edit-team, .btn-other-tournaments").toggle();$(".formations").toggle();$("body").addClass("show-msj");$(".mi-team").toggle();$("#players").toggle();$(".count-rol").attr("class","count-rol "+e).toggle();$("a.ic-choose.plus span.rol").text();$(".count-selected").text(t[0][e]);$(".maximum-number").text(t[2][e])}function callPlayers(e,t){$(".loading").show();var n=$.parseJSON(getCookie("players")),r=n[4].league,i=API_URL+"/api/leagues/"+r+"/events/players/q?",s;$.ajax({type:"GET",data:{position:e,events:t,offset:0,limit:200},url:i,dataType:"json",success:function(r){window.scrollTo(0,0);s=n[2];createListSelectPlayerJson(r,s,e,t);if(t===""){$(".mi-team li a").addClass("ic-choose");callPlayersLyF(e,n)}else{window.history.back()}},error:function(e,t,n){showError(e.response)},complete:function(){$(".loading").hide();ga("send","pageview","/equipo/seleccionar-jugadores/"+e+".html")}})}function callPlayersFilter(e){var t=[],n=$("div.header p span.count-container span.rol").attr("position");$.each(e,function(e,n){t.push($(n).children("a").attr("data-event"))});callPlayers(n,t);$("span.text-title").empty().text(i18n.getTranslation("txt_players_selection"))}function createRanking(){var e=$.parseJSON(getCookie("players")),t="last_week",n=e[3].token,r=e[6].userName,i="",s,o,u,a;$.ajax({type:"GET",url:API_URL+"/api/me/stats/ranking/q?",data:{token:n,time:t},dataType:"json",success:function(e){s=e.my_rank;o=e.points;u="";a=0;$.each(e.top_ten,function(e,t){if(e<10){if(s===t.rank){u="current-user";a=1}else{u=""}i+='<li class="'+u+'"><span class="position">'+t.rank+'</span><span class="user">'+t.nick+'</span><span class="points">'+t.points+"</span></li>"}});if(a===0){i+='<li class="current-user"><span class="position">'+s+'</span><span class="user">'+r+'</span><span class="points">'+o+"</span></li>"}$("ul.user-list").append(i)},error:function(e,t,n){showError(e.response)},complete:function(){$(".loading").hide()}})}function initialFormation(){$("#main-content").show();var e=$.parseJSON(getCookie("players")),t=e[2];createListSelectPlayer(e);createListFormationLyF(t)}function showPlayersSelectionLyF(){$("#players").toggle();$(".mi-team").show();$(".btn-filters").show();$(".btn-done, .btn-edit-team, .btn-other-tournaments").toggle();$("body").removeClass("show-msj");$(".count-rol").toggle();$(".formations").toggle()}function myTeamsWeek(e,t){var n;var r=false;$(".loading").show();$.ajax({type:"GET",url:API_URL+"/api/me/seats/q",data:{token:e,offset:0,limit:paginationResultPerPage+1,time:t},dataType:"json",success:function(n){hideMoreButton=n.seats.length<paginationResultPerPage+1;if(!hideMoreButton){$("."+t).find(".paginator").show();n.seats.pop();$("."+t).paginator(e,{offset:paginationResultPerPage,time:t,paginationResultPerPage:paginationResultPerPage})}BuildMarkUp.loadMatch(n,t)},error:function(e,r,i){if(e.status!==404){if(t!=="last_week"){showError(e.response)}else{if(e.response!==""){n=$.parseJSON(e.response);$(".last-week-match .msj-error").text(n.errors.message)}else{$(".last-week-match .msj-error").text(i18n.getTranslation("msg_service_error"))}}}else{$("."+t+" .teams-container").html('<li class="normal"><a class="match ic-arrow" href="#">'+i18n.getTranslation("txt_no_teams")+"</a></li>")}},complete:function(){$(".loading").hide()}})}function statsWeek(e){$(".loading").show();var t,n;myTeamsWeek(e,"current_week");myTeamsWeek(e,"last_week");myTeamsWeek(e,"next_week");$.ajax({type:"GET",url:API_URL+"/api/stats",data:{token:e},dataType:"json",success:function(e){t='<p class="week-date"><span></span></p>';n='<p class="week-date"><span>'+Utils.sprintf(i18n.getTranslation("txt_sum_points"),e.last_week_points)+"</span></p>";$(".current-week-match .stats").html(t);$(".last-week-match .stats").html(n);$(".next-week-match .stats").html(t)},error:function(e,t,n){if(e===404){showError(e.response)}},complete:function(){$(".loading").hide()}})}function saveTeam(e,t,n,r){var i=[];$.each(e,function(e,t){var n=t.split(":");i.push(n[1])});ga("send","pageview","/guardar-equipo");$(".loading").show();$.ajax({type:"POST",data:{id_league:n,formation:t,players:i,token:r},url:API_URL+"/api/me/seats",dataType:"json",success:function(e){if(e!==""){if(e.errors!==undefined){showError(e.errors.message)}else{initialSetTeamCookie("","seleccion");initialSetTeamCookie(r,"players");location.href="/exito.html"}}else{location.href="/error.html"}},error:function(e,t,n){var r=$.parseJSON(e.response);if(r.errors.code===1011){location.href="/suscripcion.html#create-team"}else{showError(e.response)}},complete:function(){$(".loading").hide()}})}function editTeam(e,t,n,r,i){var s=[];$.each(e,function(e,t){var n=t.split(":");s.push(n[1])});$(".loading").show();ga("send","pageview","/actualizar-equipo/id_league/"+n+"/id_league_user/"+r);$.ajax({type:"POST",data:{id_league:n,id_league_user:r,formation:t,players:s,token:i},url:API_URL+"/api/me/seats/"+r,dataType:"json",success:function(e){if(e!==""){if(e.errors!==undefined){showError(e)}else{initialSetTeamCookie("","seleccion");initialSetTeamCookie(i,"players");location.href="/mis-equipos"}}else{location.href="/error.html"}},error:function(e,t,n){showError(e.response)},complete:function(){$(".loading").hide()}})}function verifySubscription(){$(".loading").show();var e=$.parseJSON(getCookie("players")),t=e[3].token,n=API_URL+"/api/me/subscriptions";$.ajax({type:"GET",data:{token:t},url:n,dataType:"json",success:function(e){if(e.subscribed===true){location.replace("#subscription-on");location.reload()}else{location.replace("#subscription-off");location.reload()}},error:function(e,t,n){showError(e.response)},complete:function(){$(".loading").hide()}})}function sendLogin(e,t,n){$(".loading").show();$.ajax({type:"POST",data:{ani:e,pin:t},url:"/login.php",dataType:"json",success:function(e){var t,r,i=e.token,s,o,u;if(i!==""){if(n==="saveTeam"){t=$.parseJSON(getCookie("players"));r=t[1].miPlayers.split(",").clean("");s=t[4].league;o=t[0].defender+"-"+t[0].midfielder+"-"+t[0].attacker;t[3].token=i;t=JSON.stringify(t);setCookie("players",t,1e3);saveTeam(r,o,s,i)}else{u='[{"goalkeeper":"0","defender":"0","midfielder":"0","attacker":"0","manager":"0"}, {"miPlayers":""}, {"goalkeeper":1, "defender":4, "midfielder":3, "attacker":3, "manager":1}, {"token":"'+i+'"}, {"league":""}, {"season":""}, {"userName":""}]';setCookie("players",u,1e3);location.href="/home.html"}}else{showError(e)}},error:function(e,t,n){showError(e.response);$(".loading").hide()}})}function backButtonCel(){if(window.history&&window.history.pushState){$(window).on("popstate",function(){var e=location.hash,t=e.split("#!/"),n=t[1],r;if(n!==""){r=window.location.hash;if(r===""){showLeagues();document.location.hash=""}}})}}function setUser(e){var t=e[3].token;$.ajax({type:"GET",data:{token:t},url:API_URL+"/api/me",dataType:"json",success:function(t){e[6].userName=t.nick;e=JSON.stringify(e);setCookie("players",e,1e3);$("a.btn-play").css("display","block")},error:function(t,n,r){$(".btn-play").attr("href","/ligas.html");$(".btn-play").addClass("btn-play-liga");$(".btn-play").css("display","block");$(".login").css("display","block");e[3].token="";e=JSON.stringify(e);setCookie("players",e,1e3);showError(t.response)},complete:function(){$(".loading").hide()}})}function homeUserData(e){var t=$.parseJSON(getCookie("players"));t[6].userName=e.nick;t=JSON.stringify(t);setCookie("players",t,1e3);$("body.home div.current-week span.user-name").text(e.nick);$("body.home div.current-week p.teams-created span.teams-quantity").text(e.current_week_teams_created);$("body.home div.current-week p.teams-created span.team-text").text(e.current_week_teams_created==1?i18n.getTranslation("msg_team_created"):i18n.getTranslation("msg_teams_created"));$("body.home div.last-week p.user-ranking span.user-rank").text(e.last_week_rank);$("body.home div.last-week p.user-ranking span.user-points").text(e.last_week_points);$("body.home div.last-week p.user-winner span.user-nick").text(e.last_week_winner);$("body.home div.last-week p.user-winner span.user-points").text(e.last_week_winner_points);if(e.subscribed===false){$(".banner").show()}}function getUserStats(e){$.ajax({type:"GET",data:{token:e},url:API_URL+"/api/me/stats",dataType:"json",success:function(e){homeUserData(e)},error:function(e,t,n){showError(e.response)},complete:function(){$(".loading").hide()}})}function addPrizeLyF(e){var t="";$.each(e,function(n,r){t+='<li><img src="'+e.url+'" alt="premio "></li>'});$("ul.awards-image").append(t)}function callPrizes(){var e=$.parseJSON(getCookie("players")),t=e[3].token;$.ajax({type:"GET",data:{token:t},url:API_URL+"/api/contents/prize",dataType:"json",success:function(e){if(e!==""){addPrizeLyF(e)}else{location.href="/error.html"}},error:function(e,t,n){showError(e.response)},complete:function(){$(".loading").hide()}})}function showTeam(){var e=$.parseJSON(getCookie("players")),t=e[3].token,n=document.location.hash.split("="),r=n[1];initialSetTeamCookie("","seleccion");initialSetTeamCookie(t,"players");$.ajax({url:API_URL+"/api/me/seats/"+r,timeout:9e4,data:{token:t},dataType:"json",success:function(e,t,n){if(e instanceof Array&&e[0]!==undefined){$(".header-top").html("<p"+(e[0].is_winner?' class="winner">':">")+"<span>ID "+r+"</span>"+e[0].name+"<span>"+i18n.getTranslation("txt_total_points")+": "+e[0].points+"</span></p>")}}});$.ajax({url:API_URL+"/api/me/seats/"+r+"/players",timeout:9e4,data:{token:t},dataType:"json",success:function(t,n,r){createListTeamToEdit(t,e,"see-team")},error:function(e,t,n){showError(e.response)},complete:function(){$(".loading").hide()}})}function suscription(e){$(".loading").show();$.ajax({type:"GET",url:API_URL+"/api/me/subscriptions",data:{token:e},dataType:"json",success:function(e){if(e.subscribed===true){location.href="/home.html"}},error:function(e,t,n){showError(e.response)},complete:function(){$(".loading").hide()}});$("#suscribe").click(function(){$(".loading").show();$.ajax({type:"POST",data:{token:e},url:API_URL+"/api/me/subscriptions/subscribe",dataType:"json",success:function(t,n,r){if(document.location.hash==="#create-team"){miTeamCookie=$.parseJSON(getCookie("players"));miPlayers=miTeamCookie[1].miPlayers.split(",").clean("");id_league=miTeamCookie[4].league;formation=miTeamCookie[0].defender+"-"+miTeamCookie[0].midfielder+"-"+miTeamCookie[0].attacker;miTeamCookie[3].token=e;miTeamCookie=JSON.stringify(miTeamCookie);setCookie("players",miTeamCookie,1e3);saveTeam(miPlayers,formation,id_league,e)}else{location.href="/exito.html"+document.location.hash}},error:function(e,t,n){showError(e.response)},complete:function(){$(".loading").hide()}})})}function crearEquipoInit(){var e=$.parseJSON(getCookie("players"));var t=e[4].league;var n=e[5].season;if(t&&n){var e=$.parseJSON(getCookie("players"));e[4].league=t;e[5].season=n;e=JSON.stringify(e);setCookie("players",e,1e3);initialFormation()}else{$(".loading").show();var e=$.parseJSON(getCookie("players"));initialSetTeamCookie("","seleccion");initialSetTeamCookie(e[3].token,"players");var n="";var r="";var i=false;$.ajax({url:API_URL+"/api/tournaments",dataType:"json",success:function(e){$.each(e,function(e,t){if(typeof DEFAULT_SELECTED_SEASON_ID!="undefined"&&t.id_season==DEFAULT_SELECTED_SEASON_ID&&t.active_league==true){n=t.id_season;i=true;return false}});if(i==true){$.ajax({type:"GET",data:{season:n},url:API_URL+"/api/leagues/",dataType:"json",success:function(e){var t=$.parseJSON(getCookie("players"));t[4].league=e.id_league;t[5].season=n;t=JSON.stringify(t);setCookie("players",t,1e3);initialFormation();return false},error:function(){location.href="/ligas.html"},complete:function(){$(".loading").hide()}})}else{location.href="/ligas.html"}},error:function(){location.href="/ligas.html"}})}}document.title=CLIENT_TITLE;var maxPlayerAllowGeneral=PLAYERS_PER_TEAM?PLAYERS_PER_TEAM:2;var paginationResultPerPage=3;Array.prototype.clean=function(e){var t,n;for(t=0,n=this.length;t<n;t++){if(this[t]===e){this.splice(t,1);t--}}return this};var callbacksUserTeamByEvent=function(){var e=$(".loading");return{success:function(e){var t=BuildMarkUp.teamsByEvent(e);$(".teamsByEvent").append(t);if(paginationResultPerPage+1>e.length){$(".my-teams-by-event .paginator").hide()}else{$(".my-teams-by-event .paginator").show()}},error:function(e,t,n){if(e.status!==404){if(options.time!=="last_week"){showError(e.response)}else{}}else{}$(".my-teams-by-event .paginator").hide()},complete:function(){e.hide()}}};var applyBindings=function(){$selectedSeasonId=$("[data-selected-seasonid]");$selectedDayNumber=$("[data-selected-daynumber]");$selectedOffset=$("[data-selected-offset]");$selectedPhase=$("[data-selected-phase]");$selectedRound=$("[data-selected-round]");$(".events").on("click",".event-item",function(e){e.preventDefault();$(".teamsByEvent").empty();$(".my-teams-by-event").show();$selectedPhase.attr("data-selected-phase",$(this).attr("data-phase"));$selectedRound.attr("data-selected-round",$(this).attr("data-round"));var t={phase:$selectedPhase.attr("data-selected-phase"),round:$selectedRound.attr("data-selected-round")};var n=BuildMarkUp.teamsByEventHeader(t);$(".teamsByEventHeader").empty().append(n);fetchMyTeamEventsCreated($(this).attr("data-day-number"),DEFAULT_SELECTED_SEASON_ID,callbacksUserTeamByEvent(),0);$selectedSeasonId.attr("data-selected-seasonid",DEFAULT_SELECTED_SEASON_ID);$selectedDayNumber.attr("data-selected-daynumber",$(this).attr("data-day-number"));$selectedOffset.attr("data-selected-offset",0)});$(".my-teams-by-event").on("click",".paginator",function(){var e=$selectedOffset.attr("data-selected-offset")+paginationResultPerPage;return function(t){t.preventDefault();var n={phase:$selectedPhase.attr("data-selected-phase"),round:$selectedRound.attr("data-selected-round")};var r=BuildMarkUp.teamsByEventHeader(n);$(".teamsByEventHeader").empty().append(r);fetchMyTeamEventsCreated($selectedDayNumber.attr("data-selected-daynumber"),$selectedSeasonId.attr("data-selected-seasonid"),callbacksUserTeamByEvent(),e,true);e+=paginationResultPerPage}}())};var fetchMyTeamEventsCreated=function(e,t,n,r,i){var s=$(".loading");$(".events").hide();dataservice.getMyTeamsByEvent(e,t,n,r);if(!i){location.hash="teams"}};var loadMyTeamEventsCreated=function(e){var t=$(".loading");t.show();var n={success:function(e){var t=BuildMarkUp.teamEvents(e);$(".events").append(t)},error:function(e,t,n){if(e.status!==404){}else{}},complete:function(){t.hide()}};dataservice.getMyTeamEventsCreated(e,null,n)};document.addEventListener("DOMContentLoaded",function(e){i18n.translate($("body"));includeHeader();urlTreatment();applyBindings()});$(document).on("click","ul.players-list-edit li a.ic-choose",function(e){e.preventDefault();if($(this).hasClass("fulled")){$(this).parent("li").toggleClass("active")}else{$(".loading").show();$(this).parent("li").toggleClass("active");var t=document.location.hash.split("="),n=t[1];getPlayerPoints($(this),n)}});$(document).on("click","ul.list li:not(.disable).league a",function(e){e.preventDefault();$("body").addClass("active-league");$("ul.list li a.active").removeClass("active");$(this).addClass("active");$(".loading").show();showDetailsLeague($(this).attr("data-idSeason"),$(this).attr("data-time-on"))});$(document).on("click","ul.weeks li a.show-week",function(e){$(".weeks li.selected").removeClass("selected");$(this).parent("li").toggleClass("selected");$("div.last-week-match").hide();if($(this).hasClass("show-last-week"))$("div.last-week-match").show();$("div.current-week-match").hide();if($(this).hasClass("show-current-week"))$("div.current-week-match").show();$("div.next-week-match").hide();if($(this).hasClass("show-next-week"))$("div.next-week-match").show()});$(document).on("click",".btn-filters",function(e){e.preventDefault();var t=$.parseJSON(getCookie("players"));callMatches(t[5].season);$("body").addClass("filtros");$(".msj-filtro").hide()});$(document).on("click","#filters .filter-list li a",function(e){e.preventDefault();if($(this).parent("li").hasClass("minus")){$(this).parent("li").toggleClass("plus minus")}else{$(this).parent("li").toggleClass("minus plus")}});$(document).on("click","a.apply-filter",function(e){e.preventDefault();if($("ul.filter-list li.minus").length>0){callPlayersFilter($("ul.filter-list li.minus"))}else{$(".msj-filtro").show()}});$(document).on("click",".btn-done",function(e){e.preventDefault();var t=$.parseJSON(getCookie("players")),n=parseInt(t[0].goalkeeper,10)+parseInt(t[0].defender,10)+parseInt(t[0].midfielder,10)+parseInt(t[0].attacker,10)+parseInt(t[0].manager,10),r=t[1].miPlayers.split(",").clean(""),i=t[3].token,s=t[4].league,o=$("ul.formations li.selected a").text();if(n===12&&i!==""){saveTeam(r,o,s,i)}else if(n!==12){$(".msj-error").show();setTimeout(function(){$(".msj-error").hide()},3e3)}else{location.href="/perfil.html#login"}});$(document).on("click","div.header a.show-menu",function(e){e.preventDefault();$(this).toggleClass("active");$("a.hide-menu-bottom").toggleClass("active");$(".menu-container .menu").toggle()});$(document).on("click","a.hide-menu-bottom",function(e){e.preventDefault();$("a.hide-menu-bottom").toggleClass("active");$("div.header a.show-menu").toggleClass("active");$(".menu-container .menu").toggle()});$(document).on("click",".formations li a",function(e){e.preventDefault();var t=$(this).attr("data-id"),n=$(".mi-team li"),r=$.parseJSON(getCookie("players")),i;$(".formations li.selected").removeClass("selected");$(this).parent("li").toggleClass("selected");$(".mi-team li.hide").removeClass("hide");switch(t){case"1":$.each(n,function(e,t){if(e===5||e===9||e===13){t.className+=" hide"}});r[2].goalkeeper=1;r[2].defender=4;r[2].midfielder=3;r[2].attacker=3;break;case"2":$.each(n,function(e,t){if(e===5||e===12){t.className+=" hide"}});r[2].goalkeeper=1;r[2].defender=4;r[2].midfielder=4;r[2].attacker=2;break;case"3":$.each(n,function(e,t){if(e===4||e===5){t.className+=" hide"}});r[2].goalkeeper=1;r[2].defender=3;r[2].midfielder=4;r[2].attacker=3;break;case"4":$.each(n,function(e,t){if(e===9||e===12){t.className+=" hide"}});r[2].goalkeeper=1;r[2].defender=5;r[2].midfielder=3;r[2].attacker=2;break}r=JSON.stringify(r);setCookie("players",r,1e3);i=$.parseJSON(getCookie("players"));createListSelectPlayer(i)});$(document).on("click",".mi-team li a.ic-choose",function(e){e.preventDefault();var t=$(this).attr("data-pos"),n,r;if($(this).hasClass("minus")){$(this).removeClass("minus").addClass("plus");$(this).addClass("plus");removePlayer($(this),"players");r=$.parseJSON(getCookie("players"));createListSelectPlayer(r)}else{n="";$(".mi-team li a").removeClass("ic-choose");$("body").addClass("bk-create-team");callPlayers(t,n)}});$(document).on("click",".to-select li a.ic-choose",function(e){e.preventDefault();if($(this).hasClass("plus")){addPlayer($(this))}else if($(this).hasClass("minus")){$(this).removeClass("minus");$(this).addClass("plus");removePlayer($(this),"seleccion")}});$(document).on("click",".btn-back-team",function(e){e.preventDefault();setCookie("players",getCookie("seleccion"),1e3);var t=$.parseJSON(getCookie("players"));window.scrollTo(0,0);createListSelectPlayer(t);showPlayersSelectionLyF();if($("body").hasClass("editar-team")){$("span.text-title").empty().text(i18n.getTranslation("txt_edit_team"))}else{$("span.text-title").empty().text(i18n.getTranslation("txt_create_team"))}$("body").removeClass("bk-create-team");window.history.back()});$(document).on("click","a.btn-team-edit",function(e){e.preventDefault();var t=$.parseJSON(getCookie("players"));t[4].league=$(this).attr("data-idLeague");t[5].season=$(this).attr("data-idSeason");t=JSON.stringify(t);setCookie("players",t,1e3);location.href="/editar-equipo.html#edit="+$(this).attr("data-id-league-user")});$(document).on("click","a.btn-edit-team",function(e){e.preventDefault();var t=$.parseJSON(getCookie("players")),n=parseInt(t[0].goalkeeper,10)+parseInt(t[0].defender,10)+parseInt(t[0].midfielder,10)+parseInt(t[0].attacker,10)+parseInt(t[0].manager,10),r=t[1].miPlayers.split(",").clean(""),i=t[3].token,s=t[4].league,o=$("ul.formations li.selected a").text(),u=document.location.hash.split("="),a=u[1];if(n===12&&i!==""){editTeam(r,o,t[4].league,a,i)}else if(n!==12){$(".msj-error").show();setTimeout(function(){$(".msj-error").hide()},3e3)}else{location.href="/perfil.html#login"}});$(document).on("click","a.btn-confirm-league",function(e){e.preventDefault();var t=$.parseJSON(getCookie("players"));t[4].league=$(".container-details ul.list li.league").attr("data-idLeague");t[5].season=$(".container-details ul.list li.league").attr("data-idSeason");t=JSON.stringify(t);setCookie("players",t,1e3);location.href="/crear-equipo.html"});$(document).on("click","body.subscription-page a.btn-edit-user",function(e){e.preventDefault();var t=$.parseJSON(getCookie("players")),n=$(this).siblings("input.input-sub-on").val(),r=t[3].token;if(n!==""){$(".loading").show();$.ajax({type:"POST",url:API_URL+"/api/me/",data:{token:r,nick:n},dataType:"json",success:function(e){},error:function(e,t,n){showError(e.response)},complete:function(){$(".loading").hide()}})}else{showError(i18n.getTranslation("txt_name_field_incomplete"))}});$(document).on("click","a.login-user",function(e){e.preventDefault();var t=$(".cel-number").val().toString(),n=$(".cel-number-prefix").val().toString(),r=$(".personal-pass").val(),i=i18n.getTranslation("txt_error_entrada_telefono"),s=$.parseJSON(getCookie("players")),o,u="";if(getCookie("players")!==null){o=s[1].miPlayers.split(",").clean("");if(o.length>0){u="saveTeam"}}celNumber=n+t;if(/^([0-9])*$/.test(celNumber)&&n.length!==0&&t.length!==0&&r.length!==0){sendLogin(celNumber,r,u)}else{$("#login .msj-error").text(i).show();setTimeout(function(){$("#login .msj-error").hide()},3e3)}});$(document).on("click","a.send-pass-sms",function(e){e.preventDefault();location.hash="send-pwd-sms";location.reload()});$(document).on("click","a.send-sms",function(e){e.preventDefault();var t=$("input.input-sms").val().toString();var n=$("input.input-sms-prefix").val().toString();var r=$(this).siblings(".msj-error");r.hide();$("input.input-sms");var i=new RegExp(PIN_VALIDATION_REGEX,"g");var s=n+t;if(t.length&&n.length&&i.test(s)){$.ajax({type:"POST",url:API_URL+"/api/me/pin/reset/",data:{ani:s},dataType:"json",success:function(){$(".loading").hide();location.hash="login";location.reload()},error:function(e,t,n){$(".loading").hide();showError(e.response)},complete:function(){$(".loading").hide()}})}else{r.text(i18n.getTranslation("msg_invalid_phone_number")).show();setTimeout(function(){r.hide()},3e3)}});$(document).on("click","a.btn-back",function(e){window.history.back()});$(document).on("click","a.activate-subscription",function(e){e.preventDefault();ga("send","pageview","/perfil.html#btn-activar-subscripcion");$(".loading").show();var t=$.parseJSON(getCookie("players")),n=t[3].token;$.ajax({type:"POST",data:{token:n},url:API_URL+"/api/me/subscriptions/subscribe",dataType:"json",success:function(e,t,n){location.href="/perfil.html#subscription";location.reload()},error:function(e,t,n){showError(e.response)},complete:function(){$(".loading").hide()}})});$(document).on("click","a.deactivate-subscription",function(e){e.preventDefault();ga("send","pageview","/perfil.html#btn-desactivar-subscripcion");$(".loading").show();var t=$.parseJSON(getCookie("players")),n=t[3].token;$.ajax({type:"POST",data:{token:n},url:API_URL+"/api/me/subscriptions/unsubscribe",dataType:"json",success:function(e,t,n){location.hash="subscription-off";location.reload()},error:function(e,t,n){showError(e.response)},complete:function(){$(".loading").hide()}})});window.onhashchange=function(){if($("body").hasClass("bk-create-team")&&!(location.hash==="#seleccion"||location.hash==="#filter")){$("body").removeClass("bk-create-team");createListSelectPlayer($.parseJSON(getCookie("players")));showPlayersSelectionLyF();if($("body").hasClass("editar-team")){$("span.text-title").empty().text(i18n.getTranslation("txt_edit_team"))}else{$("span.text-title").empty().text(i18n.getTranslation("txt_create_team"))}}if($("body").hasClass("filtros")&&location.hash!=="#filter"){$("#players").show();$("p.count-rol").show();$("#filters").hide();$("body").removeClass("filtros").addClass("bk-create-team");$("body").toggleClass("show-msj filter-msj");$("body").removeClass("filtros filter-msj").addClass("bk-create-team show-msj");$("span.text-title").empty().text(i18n.getTranslation("txt_select_players"))}if(document.location.pathname==="/mis-equipos.html"&&document.location.hash!="#teams"){$(".my-teams-by-event").hide();$(".events").show()}};$(document).on("click",".history-back",function(e){e.preventDefault();if(($("body").hasClass("subscription-perfil")||$("body").hasClass("home"))&&$(this).text()!==i18n.getTranslation("txt_volver")){if($("#subscription").hasClass("active")){window.history.back()}}else if($("body").hasClass("league")){if(!$("body.league").hasClass("active-league")){var t=$.parseJSON(getCookie("players")),n=t[3]["token"]||"";location.href=n===""?"/index.html":"/home.html"}else{$("body.active-league").removeClass("active-league");location.reload()}}else{window.history.back()}});$(document).on("click",".banner",function(e){e.preventDefault();ga("send","pageview","/suscripcion.html");location.href="suscripcion.html#suscribe"})
